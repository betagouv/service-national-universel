import {
  ROLES,
  departmentLookUp,
  formatDateFR,
  formatDateFRTimezoneUTC,
  formatLongDateFR,
  getDepartmentNumber,
  getLabelWithdrawnReason,
  isInRuralArea,
  translate,
  translateApplication,
  translateApplicationFileType,
  translateCniExpired,
  translateEngagement,
  translateEquivalenceStatus,
  translateFileStatusPhase1,
  translateInscriptionStatus,
  translatePhase1,
  translatePhase2,
  translateYoungSource,
  translateStatusMilitaryPreparationFiles,
  canAssignManually,
} from "snu-lib";
import { orderCohort } from "../../../components/filters-system-v2/components/filters/utils";
import { formatPhoneE164 } from "../../../utils/formatPhoneE164";
import { youngCheckinField } from "@/utils";

export const getFilterArray = (user, bus, session, classes, etablissements) => {
  console.log("ðŸš€ ~ getFilterArray ~ classes:", classes);
  return [
    { title: "Cohorte", name: "cohort", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", sort: (e) => orderCohort(e) },
    { title: "Cohorte d'origine", name: "originalCohort", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", sort: orderCohort },
    { title: "Statut", name: "status", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", translate: translateInscriptionStatus, defaultValue: ["VALIDATED"] },
    { title: "Source", name: "source", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", translate: translateYoungSource },
    { title: "Pays de rÃ©sidence", name: "country", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", translate: translate },
    { title: "AcadÃ©mie", name: "academy", parentGroup: "GÃ©nÃ©ral", missingLabel: "Non renseignÃ©", translate: translate },
    {
      title: "RÃ©gion",
      name: "region",
      parentGroup: "GÃ©nÃ©ral",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "DÃ©partement",
      name: "department",
      parentGroup: "GÃ©nÃ©ral",
      missingLabel: "Non renseignÃ©",
      translate: (e) => getDepartmentNumber(e) + " - " + e,
    },
    {
      title: "Note interne",
      name: "hasNotes",
      parentGroup: "GÃ©nÃ©ral",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Classe",
      name: "grade",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Sexe",
      name: "gender",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "NationalitÃ© franÃ§aise",
      name: "frenchNationality",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    user.role === ROLES.REFERENT_DEPARTMENT
      ? {
          title: "Etablissement",
          name: "schoolName",
          parentGroup: "Dossier",
          missingLabel: "Non renseignÃ©",
          translate: translate,
        }
      : null,
    {
      title: "Situation",
      name: "situation",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "BÃ©nÃ©ficiaire PPS",
      name: "ppsBeneficiary",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "BÃ©nÃ©ficiaire PAI",
      name: "paiBeneficiary",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "RÃ©gion rurale",
      name: "isRegionRural",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "QPV",
      name: "qpv",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Handicap",
      name: "handicap",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Allergies",
      name: "allergies",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "AmÃ©nagement spÃ©cifique",
      name: "specificAmenagment",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "AccÃ¨s mobilitÃ© rÃ©duite",
      name: "reducedMobilityAccess",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Droit Ã  l'image",
      name: "imageRight",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "PiÃ¨ce d'identitÃ© pÃ©rimÃ©e",
      name: "CNIFileNotValidOnStart",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translateCniExpired,
    },
    {
      title: "PSC1",
      name: "psc1Info",
      parentGroup: "Dossier",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Statut phase 1",
      name: "statusPhase1",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translatePhase1,
    },
    {
      title: "Classe EngagÃ©e ID",
      name: "classeId",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: (item) => {
        console.log("ðŸš€ ~ getFilterArray ~ item:", typeof item);
        if (item === "N/A" || !classes.length) return item;
        return classes[item] || "N/A - SupprimÃ©";
      },
    },
    {
      title: "Etablissement CLE",
      name: "etablissementId",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: (item) => {
        if (item === "N/A" || !etablissements.length) return item;
        return etablissements[item] || "N/A - SupprimÃ©";
      },
    },
    {
      title: "Centre",
      name: "sessionPhase1Id",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: (item) => {
        if (item === "N/A" || !session.length) return item;
        return session[item] || "N/A - SupprimÃ©";
      },
    },
    {
      title: "Confirmation PDR",
      name: "hasMeetingInformation",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Affectation dans son dÃ©partement",
      name: "handicapInSameDepartment",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Confirmation de participation",
      name: "youngPhase1Agreement",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "PrÃ©sence Ã  l'arrivÃ©e",
      name: "cohesionStayPresence",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "PrÃ©sence Ã  la JDM",
      name: "presenceJDM",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "DÃ©part renseignÃ©",
      name: "departInform",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Motif du dÃ©part",
      name: "departSejourMotif",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Fiches sanitaires",
      name: "cohesionStayMedicalFileReceived",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Ligne",
      name: "ligneId",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: (item) => {
        if (item === "N/A" || !bus?.length) return item;
        return bus[item] || item;
      },
    },
    {
      title: "Voyage en avion",
      name: "isTravelingByPlane",
      parentGroup: "Phase 1",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
    {
      title: "Statut phase 2",
      name: "statusPhase2",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translatePhase2,
    },
    {
      title: "Statut mission (candidature)",
      name: "phase2ApplicationStatus",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translateApplication,
    },
    {
      title: "Statut contrats",
      name: "statusPhase2Contract",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translateEngagement,
    },
    {
      title: "Dossier d'Ã©ligibilitÃ© aux PM",
      name: "statusMilitaryPreparationFiles",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translateStatusMilitaryPreparationFiles,
    },
    {
      title: "PiÃ¨ces jointes",
      name: "phase2ApplicationFilesType",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translateApplicationFileType,
    },
    {
      title: "Equivalence de MIG",
      name: "status_equivalence",
      parentGroup: "Phase 2",
      missingLabel: "Non renseignÃ©",
      translate: translateEquivalenceStatus,
    },
    {
      title: "Statut phase 3",
      name: "statusPhase3",
      parentGroup: "Phase 3",
      missingLabel: "Non renseignÃ©",
      translate: translate,
    },
  ].filter(Boolean);
};

export async function transformVolontaires(data, values) {
  let all = data;

  return all.map((data) => {
    let center = {};
    if (data.cohesionCenterId && data.sessionPhase1Id) {
      center = data?.center;
      if (!center) center = {};
    }
    let meetingPoint = {};
    let bus = {};
    let ligneToPoint = {};
    if (data.meetingPointId && data.ligneId) {
      bus = data?.bus || {};
      ligneToPoint = data?.ligneToPoint || {};
      meetingPoint = data?.meetingPoint || {};
    }
    let classe = {};
    let etablissement = {};
    if (data.classeId) {
      classe = data?.classe || {};
    }
    if (data.etablissementId) {
      etablissement = data?.etablissement || {};
    }

    if (!data.domains) data.domains = [];
    if (!data.periodRanking) data.periodRanking = [];
    const allFields = {
      psc1Info: {
        PSC1: translate(data?.psc1Info) || "Non renseignÃ©",
      },
      identity: {
        PrÃ©nom: data.firstName,
        Nom: data.lastName,
        Sexe: translate(data.gender),
        Cohorte: data.cohort,
        "Cohorte d'origine": data.originalCohort,
      },
      contact: {
        Email: data.email,
        TÃ©lÃ©phone: formatPhoneE164(data.phone, data.phoneZone),
      },
      birth: {
        "Date de naissance": formatDateFRTimezoneUTC(data.birthdateAt),
        "Pays de naissance": data.birthCountry || "France",
        "Ville de naissance": data.birthCity,
        "Code postal de naissance": data.birthCityZip,
        "Date de fin de validitÃ© de la piÃ¨ce d'identitÃ©": formatDateFRTimezoneUTC(data?.latestCNIFileExpirationDate),
      },
      address: {
        "Adresse postale": data.address,
        "Code postal": data.zip,
        Ville: data.city,
        Pays: data.country,
        "Nom de l'hÃ©bergeur": data.hostLastName,
        "PrÃ©nom de l'hÃ©bergeur": data.hostFirstName,
        "Lien avec l'hÃ©bergeur": data.hostRelationship,
        "Adresse - Ã©tranger": data.foreignAddress,
        "Code postal - Ã©tranger": data.foreignZip,
        "Ville - Ã©tranger": data.foreignCity,
        "Pays - Ã©tranger": data.foreignCountry,
      },
      location: {
        DÃ©partement: data.department,
        AcadÃ©mie: data.academy,
        RÃ©gion: data.region,
      },
      schoolSituation: {
        Situation: translate(data.situation),
        Niveau: translate(data.grade),
        "Type d'Ã©tablissement": translate(data.school?.type || data.schoolType),
        "Nom de l'Ã©tablissement": data.school?.fullName || data.schoolName,
        "Code postal de l'Ã©tablissement": data.school?.postcode || data.schoolZip,
        "Ville de l'Ã©tablissement": data.school?.city || data.schoolCity,
        "DÃ©partement de l'Ã©tablissement": departmentLookUp[data.school?.department] || data.schoolDepartment,
        "UAI de l'Ã©tablissement": data.school?.uai,
      },
      situation: {
        "Quartier Prioritaire de la ville": translate(data.qpv),
        "Zone Rurale": translate(isInRuralArea(data)),
        Handicap: translate(data.handicap),
        "BÃ©nÃ©ficiaire d'un PPS": translate(data.ppsBeneficiary),
        "BÃ©nÃ©ficiaire d'un PAI": translate(data.paiBeneficiary),
        "AmÃ©nagement spÃ©cifique": translate(data.specificAmenagment),
        "Nature de l'amÃ©nagement spÃ©cifique": translate(data.specificAmenagmentType),
        "AmÃ©nagement pour mobilitÃ© rÃ©duite": translate(data.reducedMobilityAccess),
        "Besoin d'Ãªtre affectÃ©(e) dans le dÃ©partement de rÃ©sidence": translate(data.handicapInSameDepartment),
        "Allergies ou intolÃ©rances alimentaires": translate(data.allergies),
        "ActivitÃ© de haut-niveau": translate(data.highSkilledActivity),
        "Nature de l'activitÃ© de haut-niveau": data.highSkilledActivityType,
        "ActivitÃ©s de haut niveau nÃ©cessitant d'Ãªtre affectÃ© dans le dÃ©partement de rÃ©sidence": translate(data.highSkilledActivityInSameDepartment),
        "Document activitÃ© de haut-niveau ": data.highSkilledActivityProofFiles,
        "Structure mÃ©dico-sociale": translate(data.medicosocialStructure),
        "Nom de la structure mÃ©dico-sociale": data.medicosocialStructureName, // diffÃ©rence avec au-dessus ?
        "Adresse de la structure mÃ©dico-sociale": data.medicosocialStructureAddress,
        "Code postal de la structure mÃ©dico-sociale": data.medicosocialStructureZip,
        "Ville de la structure mÃ©dico-sociale": data.medicosocialStructureCity,
      },
      cle: {
        "NationalitÃ© franÃ§aise": translate(data.frenchNationality),
        "Etablissement UAI": etablissement?.uai,
        "Classe EngagÃ©e ID": data.classeId,
        Coloration: translate(classe?.coloration),
      },
      representative1: {
        "Statut reprÃ©sentant lÃ©gal 1": translate(data.parent1Status),
        "PrÃ©nom reprÃ©sentant lÃ©gal 1": data.parent1FirstName,
        "Nom reprÃ©sentant lÃ©gal 1": data.parent1LastName,
        "Email reprÃ©sentant lÃ©gal 1": data.parent1Email,
        "TÃ©lÃ©phone reprÃ©sentant lÃ©gal 1": formatPhoneE164(data.parent1Phone, data.parent1PhoneZone),
        "Adresse reprÃ©sentant lÃ©gal 1": data.parent1Address,
        "Code postal reprÃ©sentant lÃ©gal 1": data.parent1Zip,
        "Ville reprÃ©sentant lÃ©gal 1": data.parent1City,
        "DÃ©partement reprÃ©sentant lÃ©gal 1": data.parent1Department,
        "RÃ©gion reprÃ©sentant lÃ©gal 1": data.parent1Region,
      },
      representative2: {
        "Statut reprÃ©sentant lÃ©gal 2": translate(data.parent2Status),
        "PrÃ©nom reprÃ©sentant lÃ©gal 2": data.parent2FirstName,
        "Nom reprÃ©sentant lÃ©gal 2": data.parent2LastName,
        "Email reprÃ©sentant lÃ©gal 2": data.parent2Email,
        "TÃ©lÃ©phone reprÃ©sentant lÃ©gal 2": formatPhoneE164(data.parent2Phone, data.parent2PhoneZone),
        "Adresse reprÃ©sentant lÃ©gal 2": data.parent2Address,
        "Code postal reprÃ©sentant lÃ©gal 2": data.parent2Zip,
        "Ville reprÃ©sentant lÃ©gal 2": data.parent2City,
        "DÃ©partement reprÃ©sentant lÃ©gal 2": data.parent2Department,
        "RÃ©gion reprÃ©sentant lÃ©gal 2": data.parent2Region,
      },
      consent: {
        "Consentement des reprÃ©sentants lÃ©gaux": translate(data.parentConsentment),
      },
      status: {
        "Statut gÃ©nÃ©ral": translate(data.status),
        Phase: translate(data.phase),
        "Statut Phase 1": translatePhase1(data.statusPhase1),
        "Statut Phase 2": translatePhase2(data.statusPhase2),
        "Statut Phase 3": translate(data.statusPhase3),
        "Dernier statut le": formatLongDateFR(data.lastStatusAt),
      },
      phase1Affectation: {
        "ID centre": center._id || "",
        "Matricule centre": center.matricule || "",
        "Nom du centre": center.name || "",
        "Ville du centre": center.city || "",
        "DÃ©partement du centre": center.department || "",
        "RÃ©gion du centre": center.region || "",
      },
      phase1Transport: {
        "Se rend au centre par ses propres moyens": translate(data.deplacementPhase1Autonomous),
        "Informations de transports transmises par email": translate(data.transportInfoGivenByLocal),
        "Bus nËš": bus?.busId,
        "Nom du point de rassemblement": meetingPoint?.name,
        "Adresse point de rassemblement": meetingPoint?.address,
        "Ville du point de rassemblement": meetingPoint?.city,
        "Date aller": formatDateFR(bus?.departuredDate),
        "Heure de dÃ©part": ligneToPoint?.departureHour,
        "Heure de convocation": ligneToPoint?.meetingHour,
        "Date retour": formatDateFR(bus?.returnDate),
        "Heure de retour": ligneToPoint?.returnHour,
        "Voyage en avion": translate(data?.isTravelingByPlane),
      },
      phase1DocumentStatus: {
        "Droit Ã  l'image - Statut": translateFileStatusPhase1(data.imageRightFilesStatus) || "Non RenseignÃ©",
        "Autotest PCR - Statut": translateFileStatusPhase1(data.autoTestPCRFilesStatus) || "Non RenseignÃ©",
        "RÃ¨glement intÃ©rieur": translate(data.rulesYoung),
        "Fiche sanitaire rÃ©ceptionnÃ©e": translate(data.cohesionStayMedicalFileReceived) || "Non RenseignÃ©",
      },
      phase1DocumentAgreement: {
        "Droit Ã  l'image - Accord": translate(data.imageRight),
        "Autotest PCR - Accord": translate(data.autoTestPCR),
      },
      phase1Attendance: {
        "PrÃ©sence Ã  l'arrivÃ©e": !data.cohesionStayPresence ? "Non renseignÃ©e" : data.cohesionStayPresence === "true" ? "PrÃ©sent" : "Absent",
        "PrÃ©sence Ã  la JDM": !data.presenceJDM ? "Non renseignÃ©e" : data.presenceJDM === "true" ? "PrÃ©sent" : "Absent",
        "Date de dÃ©part": !data.departSejourAt ? "Non renseignÃ©e" : formatDateFRTimezoneUTC(data.departSejourAt),
        "Motif du dÃ©part": data?.departSejourMotif,
        "Commentaire du dÃ©part": data?.departSejourMotifComment,
      },
      phase2: {
        "Domaine de MIG 1": data.domains[0],
        "Domaine de MIG 2": data.domains[1],
        "Domaine de MIG 3": data.domains[2],
        "Projet professionnel": translate(data.professionnalProject),
        "Information supplÃ©mentaire sur le projet professionnel": data.professionnalProjectPrecision,
        "PÃ©riode privilÃ©giÃ©e pour rÃ©aliser des missions": data.period,
        "Choix 1 pÃ©riode": translate(data.periodRanking[0]),
        "Choix 2 pÃ©riode": translate(data.periodRanking[1]),
        "Choix 3 pÃ©riode": translate(data.periodRanking[2]),
        "Choix 4 pÃ©riode": translate(data.periodRanking[3]),
        "Choix 5 pÃ©riode": translate(data.periodRanking[4]),
        "MobilitÃ© aux alentours de son Ã©tablissement": translate(data.mobilityNearSchool),
        "MobilitÃ© aux alentours de son domicile": translate(data.mobilityNearHome),
        "MobilitÃ© aux alentours d'un de ses proches": translate(data.mobilityNearRelative),
        "Informations du proche":
          data.mobilityNearRelative &&
          [data.mobilityNearRelativeName, data.mobilityNearRelativeAddress, data.mobilityNearRelativeZip, data.mobilityNearRelativeCity].filter((e) => e)?.join(", "),
        "Mode de transport": data.mobilityTransport?.map((t) => translate(t)).join(", "),
        "Autre mode de transport": data.mobilityTransportOther,
        "Format de mission": translate(data.missionFormat),
        "Engagement dans une structure en dehors du SNU": translate(data.engaged),
        "Description engagement ": data.engagedDescription,
        "Souhait MIG": data.desiredLocation,
      },
      accountDetails: {
        "CrÃ©Ã© lÃ©": formatLongDateFR(data.createdAt),
        "Mis Ã  jour le": formatLongDateFR(data.updatedAt),
        "DerniÃ¨re connexion le": formatLongDateFR(data.lastLoginAt),
      },
      desistement: {
        "Raison du dÃ©sistement": getLabelWithdrawnReason(data.withdrawnReason),
        "Message de dÃ©sistement": data.withdrawnMessage,
        // Date du dÃ©sistement: // not found in db
      },
    };

    let fields = { ID: data._id };
    for (const element of values) {
      let key;
      for (key in allFields[element]) fields[key] = allFields[element][key];
    }
    return fields;
  });
}

export async function transformVolontairesSchool(data) {
  let all = data;
  return all.map((data) => {
    return {
      _id: data._id,
      Cohorte: data.cohort,
      PrÃ©nom: data.firstName,
      Nom: data.lastName,
      DÃ©partement: data.department,
      Situation: translate(data.situation),
      Niveau: translate(data.grade),
      "Type d'Ã©tablissement": translate(data.school?.type || data.schoolType),
      "Nom de l'Ã©tablissement": data.school?.fullName || data.schoolName,
      "Code postal de l'Ã©tablissement": data.school?.postcode || data.schoolZip,
      "Ville de l'Ã©tablissement": data.school?.city || data.schoolCity,
      "DÃ©partement de l'Ã©tablissement": departmentLookUp[data.school?.department] || data.schoolDepartment,
      "UAI de l'Ã©tablissement": data.school?.uai,
      "Statut gÃ©nÃ©ral": translate(data.status),
      "Statut Phase 1": translate(data.statusPhase1),
    };
  });
}

export async function transformInscription(data) {
  let all = data;
  return all.map((data) => {
    return {
      _id: data._id,
      Cohorte: data.cohort,
      PrÃ©nom: data.firstName,

      Nom: data.lastName,
      "Date de naissance": formatDateFRTimezoneUTC(data.birthdateAt),
      "Pays de naissance": data.birthCountry || "France",
      "Ville de naissance": data.birthCity,
      "Code postal de naissance": data.birthCityZip,
      "Date de fin de validitÃ© de la piÃ¨ce d'identitÃ©": formatDateFRTimezoneUTC(data?.latestCNIFileExpirationDate),
      Sexe: translate(data.gender),
      Email: data.email,
      TÃ©lÃ©phone: formatPhoneE164(data.phone, data.phoneZone),
      "Adresse postale": data.address,
      "Code postal": data.zip,
      Ville: data.city,
      DÃ©partement: data.department,
      RÃ©gion: data.region,
      AcadÃ©mie: data.academy,
      Pays: data.country,
      "Nom de l'hÃ©bergeur": data.hostLastName,
      "PrÃ©nom de l'hÃ©bergeur": data.hostFirstName,
      "Lien avec l'hÃ©bergeur": data.hostRelationship,
      "Adresse - Ã©tranger": data.foreignAddress,
      "Code postal - Ã©tranger": data.foreignZip,
      "Ville - Ã©tranger": data.foreignCity,
      "Pays - Ã©tranger": data.foreignCountry,
      Situation: translate(data.situation),
      Niveau: data.grade,
      "Type d'Ã©tablissement": translate(data.school?.type || data.schoolType),
      "Nom de l'Ã©tablissement": data.school?.fullName || data.schoolName,
      "Code postal de l'Ã©tablissement": data.school?.postcode || data.schoolZip,
      "Ville de l'Ã©tablissement": data.school?.city || data.schoolCity,
      "DÃ©partement de l'Ã©tablissement": departmentLookUp[data.school?.department] || data.schoolDepartment,
      "UAI de l'Ã©tablissement": data.school?.uai,
      "Quartier Prioritaire de la ville": translate(data.qpv),
      "Zone Rurale": translate(isInRuralArea(data)),
      Handicap: translate(data.handicap),
      "BÃ©nÃ©ficiaire d'un PPS": translate(data.ppsBeneficiary),
      "BÃ©nÃ©ficiaire d'un PAI": translate(data.paiBeneficiary),
      "Structure mÃ©dico-sociale": translate(data.medicosocialStructure),
      "Nom de la structure mÃ©dico-sociale": data.medicosocialStructureName,
      "Adresse de la structure mÃ©dico-sociale": data.medicosocialStructureAddress,
      "Code postal de la structure mÃ©dico-sociale": data.medicosocialStructureZip,
      "Ville de la structure mÃ©dico-sociale": data.medicosocialStructureCity,
      "AmÃ©nagement spÃ©cifique": translate(data.specificAmenagment),
      "Nature de l'amÃ©nagement spÃ©cifique": data.specificAmenagmentType,
      "AmÃ©nagement pour mobilitÃ© rÃ©duite": translate(data.reducedMobilityAccess),
      "Besoin d'Ãªtre affectÃ©(e) dans le dÃ©partement de rÃ©sidence": translate(data.handicapInSameDepartment),
      "Allergies ou intolÃ©rances alimentaires": translate(data.allergies),
      "ActivitÃ© de haut-niveau": translate(data.highSkilledActivity),
      "Nature de l'activitÃ© de haut-niveau": data.highSkilledActivityType,
      "ActivitÃ©s de haut niveau nÃ©cessitant d'Ãªtre affectÃ© dans le dÃ©partement de rÃ©sidence": translate(data.highSkilledActivityInSameDepartment),
      "Document activitÃ© de haut-niveau ": data.highSkilledActivityProofFiles,
      "Consentement des reprÃ©sentants lÃ©gaux": translate(data.parentConsentment),
      "Droit Ã  l'image": translate(data.imageRight),
      "Autotest PCR": translate(data.autoTestPCR),
      "RÃ¨glement intÃ©rieur": translate(data.rulesYoung),
      "Fiche sanitaire rÃ©ceptionnÃ©e": translate(data.cohesionStayMedicalFileReceived) || "Non RenseignÃ©",
      PSC1: translate(data.psc1Info) || "Non RenseignÃ©",
      "Statut reprÃ©sentant lÃ©gal 1": translate(data.parent1Status),
      "PrÃ©nom reprÃ©sentant lÃ©gal 1": data.parent1FirstName,
      "Nom reprÃ©sentant lÃ©gal 1": data.parent1LastName,
      "Email reprÃ©sentant lÃ©gal 1": data.parent1Email,
      "TÃ©lÃ©phone reprÃ©sentant lÃ©gal 1": formatPhoneE164(data.parent1Phone, data.parent1PhoneZone),
      "Adresse reprÃ©sentant lÃ©gal 1": data.parent1Address,
      "Code postal reprÃ©sentant lÃ©gal 1": data.parent1Zip,
      "Ville reprÃ©sentant lÃ©gal 1": data.parent1City,
      "DÃ©partement reprÃ©sentant lÃ©gal 1": data.parent1Department,
      "RÃ©gion reprÃ©sentant lÃ©gal 1": data.parent1Region,
      "Statut reprÃ©sentant lÃ©gal 2": translate(data.parent2Status),
      "PrÃ©nom reprÃ©sentant lÃ©gal 2": data.parent2FirstName,
      "Nom reprÃ©sentant lÃ©gal 2": data.parent2LastName,
      "Email reprÃ©sentant lÃ©gal 2": data.parent2Email,
      "TÃ©lÃ©phone reprÃ©sentant lÃ©gal 2": formatPhoneE164(data.parent2Phone, data.parent2PhoneZone),
      "Adresse reprÃ©sentant lÃ©gal 2": data.parent2Address,
      "Code postal reprÃ©sentant lÃ©gal 2": data.parent2Zip,
      "Ville reprÃ©sentant lÃ©gal 2": data.parent2City,
      "DÃ©partement reprÃ©sentant lÃ©gal 2": data.parent2Department,
      "RÃ©gion reprÃ©sentant lÃ©gal 2": data.parent2Region,
      Motivation: data.motivations,
      Phase: translate(data.phase),
      "CrÃ©Ã© lÃ©": formatLongDateFR(data.createdAt),
      "Mis Ã  jour le": formatLongDateFR(data.updatedAt),
      "DerniÃ¨re connexion le": formatLongDateFR(data.lastLoginAt),
      "Statut gÃ©nÃ©ral": translate(data.status),
      "Dernier statut le": formatLongDateFR(data.lastStatusAt),
    };
  });
}

export function isCohortOpenForAffectation(user, young, cohort) {
  if (!user || !young || !cohort) return false;
  if (young.status !== "VALIDATED" && young.status !== "WAITING_LIST") {
    return false;
  } else if (cohort) {
    return canAssignManually(user, young, cohort);
  } else {
    return false;
  }
}

export function isYoungCheckIsOpen(user, cohort) {
  if (!cohort || !user) return false;
  const field = youngCheckinField[user.role];
  return field ? !!cohort[field] : false;
}
