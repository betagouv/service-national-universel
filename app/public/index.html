<!DOCTYPE html>
<html lang="fr" class="notranslate" translate="no">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="google" content="notranslate" />
    <title>SNU</title>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script>
      window.axeptioSettings = {
        clientId: "5fec5b2a5558222597c2fd85",
        cookiesVersion: "snu app-base",
      };

      (function (d, s) {
        var t = d.getElementsByTagName(s)[0],
          e = d.createElement(s);
        e.async = true;
        e.src = "//static.axept.io/sdk.js";
        t.parentNode.insertBefore(e, t);
      })(document, "script");
    </script>
  </head>

  <body>
    <noscript> You need to enable JavaScript to run this app. </noscript>
    <div id="root"></div>
    <script>
      window.axeptioSettings = {
        clientId: "606c516d6ac944450f1e899d",
        cookiesVersion: "snu-base",
      };

      (function (d, s) {
        var t = d.getElementsByTagName(s)[0],
          e = d.createElement(s);
        e.async = true;
        e.src = "//static.axept.io/sdk.js";
        t.parentNode.insertBefore(e, t);
      })(document, "script");
    </script>
    <div id="zammad-chat"></div>
    <script src="https://support.selego.co/assets/chat/chat.min.js"></script>
    <script>
      $(function () {
        
        if (typeof ZammadChat === "undefined") return;

        var chat = new ZammadChat({
          title: "Une question ?",
          background: "#5145cd",
          fontSize: "12px",
          chatId: 4,
          show: true,
          flat: true,
          target: $("#zammad-chat"),
        });

        // Monkey patch Zammad.
        
        // This send the user informations to zammad.
        chat.onConnectionEstablished = (data) => {
          var isNew = Boolean(data.session_id);
          ZammadChat.prototype.onConnectionEstablished.call(chat, data);
          if (isNew) {
            var url = "https://app-735c50af-69c1-4a10-ac30-7ba11d1112f7.cleverapps.io";
            if (window.location.href.includes("localhost")) url = "http://localhost:8082";
            if (window.location.href.includes("snu.gouv.fr")) url = "https://admin.snu.gouv.fr";
            var info;
            if (window.zammadUser) info = "<a href=\"" + url + "/volontaire/" + window.zammadUser._id + "\">" + window.zammadUser.name + "</a> - " + window.zammadUser.email + "<br />Statut : " + window.zammadUser.status + " | Phase 1 : " + window.zammadUser.statusPhase1 + " | Phase 2 : " + window.zammadUser.statusPhase2 + " | Phase 3 : " + window.zammadUser.statusPhase3;
            else info = "Non connect√©.";
            chat.send('chat_session_message', {
              content: "üßë‚Äçüéì " + info,
              id: chat._messageCount,
              session_id: chat.sessionId
            });

          }
        };

        // This is needed to ensure users never sees their informations when they refresh page.
        chat.onReopenSession = (data) => {
          data.session = (data.session || []).filter(message => message.content.startsWith('INFO USER: ') === false && message.content.startsWith('üßë‚Äçüéì ') === false);
          ZammadChat.prototype.onReopenSession.call(chat, data);
        };

        // End of monkey patch
      });
    </script>
  </body>
</html>
